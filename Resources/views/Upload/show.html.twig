{#{% set is_ajax = app.request.isXmlHttpRequest() %}#}
{#{% extends is_ajax ? '@UploadData/base_ajax_modal.html.twig' : '@UploadData/base.html.twig' %}#}
{% extends '@UploadData/base.html.twig' %}

{% block headline %}Show
    <small>{{ upload.filename }}</small>{% endblock %}

{% from _self import errors %}

{% block head_style %}
    {{ parent() }}
    <style>
        .popover { max-width: 600px }
    </style>
{% endblock %}
{% block content %}
    {# La idea ac√° es obtener la config de este tipo de upload para asi mostrar los datos. #}
    <table class="table table-bordered">
        <thead>
            <tr>
                {% for label in upload_config.columnsMapper.labels %}
                    <th>{{ label|title }}</th>
                {% endfor %}
                <th>Errors</th>
            </tr>
        </thead>
        {% for item in upload.items %}
            <tr>
                {% for name in upload_config.columnsMapper.names %}
                    <td>{{ item.data[name]|default }}</td>
                {% endfor %}
                <td>
                    {% if item.errors|length > 0 -%}
                        <span class="btn btn-danger btn-xs"
                              data-toggle="popover"
                              data-content="{{ errors(item.errors, upload_config.columnsMapper)|escape }}">
                            Detalle
                        </span>
                    {%- else -%}
                        ------
                    {%- endif %}
                </td>
            </tr>
        {% endfor %}
    </table>

    {#{% if not is_ajax %}#}
    {#&#123;&#35;<input type="submit" class="btn btn-primary">&#35;&#125;#}
    {#<div class="progress" id="upload-progress" style="display: none">#}
    {#<div class="progress-bar" style="width: 60%;"></div>#}
    {#</div>#}
    {#{% endif %}#}
    <a href="{{ path('upload_data_upload_list', {type: type}) }}" class="btn btn-default">Volver al Listado</a>

{% endblock %}

{#{% block modal_footer %}#}
    {#{{ parent() }}#}
    {#&#123;&#35;<input type="submit" class="btn btn-primary">&#35;&#125;#}
{#{% endblock %}#}

{% block foot_script %}
    {{ parent() }}
    <script>
        $('[data-toggle="popover"]').popover({
            html: true,
            placement: 'left',
            trigger: 'click hover'
        });
    </script>
{% endblock %}

{%- macro errors(errors, mapper) -%}
    <table class="table table-bordered table-condensed">
        {%- for column, errors in errors -%}
            <tr>
                <td><strong>{{ mapper.getLabel(column)|title }}</strong></td>
                <td>
                    <ul>
                        <li>{{ errors|join('</li><li>')|raw }}</li>
                    </ul>
                </td>
            </tr>
        {%- endfor -%}
    </table>
{%- endmacro -%}